# ğŸ¦ ì€í–‰ ì°½êµ¬ ë§¤ë‹ˆì €

>í”„ë¡œì íŠ¸ ê¸°ê°„ 2022.04.25 ~ 2022.05.06
>
>íŒ€ì› : [dudu](https://github.com), [Eddy](https://github.com/kimkyunghun3) / ë¦¬ë·°ì–´ : [ë˜ì¹˜](https://github.com/TTOzzi)

## ëª©ì°¨

- [í”„ë¡œì íŠ¸ ì†Œê°œ](#í”„ë¡œì íŠ¸-ì†Œê°œ)
- [UML](#UML)
- [í‚¤ì›Œë“œ](#í‚¤ì›Œë“œ)
- [ê³ ë¯¼í•œì ](#ê³ ë¯¼í•œì )
- [ë°°ìš´ê°œë…](#ë°°ìš´ê°œë…)

## í”„ë¡œì íŠ¸ ì†Œê°œ

ì€í–‰ ì°½êµ¬ ë§¤ë‹ˆì € ë§Œë“¤ê¸°!

![](https://i.imgur.com/LtcGejF.gif)

## UML
![](https://i.imgur.com/VEDUGMV.png)

## ê°œë°œí™˜ê²½ ë° ë¼ì´ë¸ŒëŸ¬ë¦¬
![swift](https://img.shields.io/badge/swift-5.5-orange)
![xcode](https://img.shields.io/badge/Xcode-13.0-blue)
![iOS](https://img.shields.io/badge/iOS-14.0-yellow)

## í‚¤ì›Œë“œ

`git flow` `Queue` `LinkedList` `TDD` `Protocol Oriented Programming` `ì¶”ìƒí™”` `GCD` `DispatchQueue` `DispatchSemaphore` `DispatchGroup` `Thread` `Timer` `OperationQueue` `Closure` `Trailing Closure`

## ê³ ë¯¼í•œì 

- test ì½”ë“œì™€ ì‹¤ì œ ì½”ë“œì˜ ì»¤ë°‹ ë‹¨ìœ„
- ì´ë¯¸ ê²€ì¦ëœ ë§¤ì„œë“œë¥¼ ë‹¤ë¥¸ ë§¤ì„œë“œì˜ í…ŒìŠ¤íŠ¸ì—ì„œ ì‚¬ìš©í•˜ëŠ”ê²ƒ
- êµ¬ì¡°ì²´ê°€ ì°¸ì¡°íƒ€ì…ì„ í”„ë¡œí¼í‹°ë¡œ ê°€ì§€ê³  ìˆëŠ” ê²½ìš°
- êµ¬ì¡°ì²´ì˜ mutating í‚¤ì›Œë“œ
- Thread.sleep()
- private ë§¤ì„œë“œ í…ŒìŠ¤íŠ¸ ì—¬ë¶€
- STEP2ì˜ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ í…ŒìŠ¤íŠ¸ ë°©ë²•
- testcode ë©”ì„œë“œ í…ŒìŠ¤íŠ¸ í•˜ëŠ” ë‹¨ìœ„
- Delegateë¥¼ weakìœ¼ë¡œ ì„ ì–¸í•˜ëŠ” ë¶€ë¶„
- bank í´ë¡œì € ì† bank, bankWindow delegate ì±„íƒ
- í•­ìƒ weak selfë¥¼ ì¨ë„ ë˜ëŠ”ì§€
- ë™ì¼ ë¡œì§ì˜ ì—°ì‚° í”„ë¡œí¼í‹° vs ë©”ì„œë“œ vs extensionì˜ ì°¨ì´
- ì„¸ë§ˆí¬ì–´ global Thread ë¡œì§ ë¶€ë¶„ë¥¼ ë¶„ë¦¬í•  ìˆ˜ ìˆì„ê¹Œ?
- Enum namespace ìš”ì†Œë³„ ë¶„ë¦¬ë¥¼ ì–´ëŠì •ë„ë¡œ í•´ì•¼í•˜ëŠ”ì§€?
- lazy var ì‚¬ìš©
- íŒŒì¼ í•œ ê³³ì— ì—¬ëŸ¬ extensionë¥¼ ì‚¬ìš©ì´ ê´œì°®ì„ê¹Œ?
- ë°ì´í„° ì „ì†¡ ë°©ì‹ Delegate, Closure ê°ê°ì˜ ì¥ë‹¨ì 
- í›„í–‰ í´ë¡œì €ì˜ ì‹¤ì œ ì‘ë™ ë°©ì‹ ê³¼ multiple í›„í–‰ í´ë¡œì €ì˜ ê°œë…

### ìì„¸í•œ ê³ ë¯¼ ë³´ê¸°

#### [STEP1](https://github.com/yagom-academy/ios-bank-manager/pull/144)
#### [STEP2](https://github.com/yagom-academy/ios-bank-manager/pull/154)
#### [STEP3](https://github.com/yagom-academy/ios-bank-manager/pull/163)
#### [STEP4](https://github.com/yagom-academy/ios-bank-manager/pull/174)

## ë°°ìš´ê°œë…

#### CFAbsoluteTimeGetCurrent() ì„ ì‚¬ìš©í•´ì„œ ì½”ë“œì˜ ì‹¤í–‰ì‹œê°„ì„ ì¸¡ì •í•  ìˆ˜ ìˆëŠ” ë²•

`CFAbsoluteTimeGetCurrent()` ë©”ì„œë“œì˜ ê³µì‹ë¬¸ì„œ ì •ì˜ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.
> Returns the current system absolute time.

í˜„ì¬ ì‹œìŠ¤í…œì˜ ì ˆëŒ€ì ì¸ ì‹œê°„ì„ ë¦¬í„´í•¨ìœ¼ë¡œì¨ ì´ë¥¼ í™œìš©í•´ì„œ ì‹œê°„ ì¸¡ì •ì„ í–ˆë‹¤.
í´ë¡œì €ë¥¼ í™œìš©í•´ì„œ ì¤‘ê°„ì— í˜¸ì¶œ ë  ê²ƒì„ ì •í•˜ê³  ì‹œì‘ ì‹œê°„ê³¼ ëë‚˜ëŠ” ì‹œê°„ì„ ì •í•˜ê³  ì´ë¥¼ ëº€ ê°’ì´ ì‹¤ì œ 
ì¤‘ê°„ target()ì˜ ì‹¤í–‰ì‹œê°„ìœ¼ë¡œ ì¸¡ì •ì´ ê°€ëŠ¥í•˜ê²Œ ë˜ì—ˆë‹¤.

```swift 
private func checkTime(target: () -> Void) -> Double {
    let startTime = CFAbsoluteTimeGetCurrent()
    target()
    let endTime = CFAbsoluteTimeGetCurrent()
    return (endTime - startTime)
}
```

#### enumê³¼ rawValue í™œìš©í•œ ìœ ì € ì…ë ¥ ì²˜ë¦¬

enumì˜ rawValueë¥¼ í™œìš©í•´ì„œ ìœ ì €ì˜ ì…ë ¥ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„í–ˆë‹¤.
ì´ë ‡ê²Œ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ìœ ì €ì˜ ì…ë ¥ì„ ë‹¨ìˆœ ìˆ«ìë¡œ íŒë‹¨í•˜ëŠ”ê²ƒì´ ì•„ë‹ˆë¼ rawValueì— ì ì ˆí•œ ì¼€ì´ìŠ¤ë¡œ
ë§¤ì¹­ë˜ê¸° ë•Œë¬¸ì— ê°€ë…ì„±ë„ ì˜¬ë¼ê°€ê³  ì‹¤ì œ ë‹¤ë¥¸ ì˜µì…˜ì´ ì¶”ê°€ë˜ì–´ë„ enumë¶€ë¶„ë§Œ ë³€ê²½í•´ì£¼ë©´ ë˜ê¸° ë•Œë¬¸ì— 
ë³€ê²½ì— ìš©ì´í•˜ê²Œ ëŒ€ì²˜ê°€ ê°€ëŠ¥í•´ì§„ë‹¤.

```swift
// ì„ ì–¸ë¶€
enum Banking: CaseIterable {
    case deposit
    case loan
}

extension Banking {
    var name: String {
        switch self {
        case .deposit:
            return "ì˜ˆê¸ˆ"
        case .loan:
            return "ëŒ€ì¶œ"
        }
    }

    var processTime: Double {
        switch self {
        case .deposit:
            return 0.7
        case .loan:
            return 1.1
        }
    }
}

// í˜¸ì¶œë¶€ 
private func inputUserOption() -> MenuOption {
    guard let userInput = readLine()?.trimmingCharacters(in: .whitespaces),
          let userSelection = MenuOption(rawValue: userInput) else { return .invalidInput }

    return userSelection
}
```

#### Protocolì„ ì´ìš©í•œ ì¶”ìƒí™”

Protocolë¥¼ ì´ìš©í•˜ë©´ ì‚¬ìš©í•  ë©”ì„œë“œë‚˜ í”„ë¡œí¼í‹°ë¥¼ ëª¨ì•„ì„œ ì¶”ìƒí™” íƒ€ì…ì„ ë§Œë“¤ê³ , 
ì´ë¥¼ ì±„íƒí•˜ëŠ” ê°ì²´ì—ì„œ ì‹¤ì œë¡œ êµ¬í˜„í•˜ëŠ” ì‹ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤
ì´ëŸ°ì‹ìœ¼ë¡œ ì‹¤ì œ íƒ€ì…ì„ ì¶”ìƒí™” ì‹œì¼œì„œ, ë”ìš± ìœ ì—°í•œ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤
ë˜í•œ Protocol + extensionë¥¼ ì‚¬ìš©í•˜ë©´ í”„ë¡œí¼í‹°ë‚˜ ë§¤ì„œë“œì˜ ê¸°ë³¸ êµ¬í˜„ì´ ê°€ëŠ¥í•˜ê³ , ì‚¬ìš©í•˜ëŠ” ê³³ì—ì„œëŠ” ì´ë¥¼ í˜¸ì¶œë§Œ í•˜ê²Œí•  ìˆ˜ ìˆë‹¤.

```swift 
protocol BankWindow: AnyObject {
    func receive(_ customer: Customer)
    var delegate: BankWindowDelegate? { get set }
}

class BankLoanWindow: BankWindow {
    weak var delegate: BankWindowDelegate?
    let workType: Banking = .loan

    func receive(_ customer: Customer) {
        delegate?.customerWorkDidStart(self, customer: customer)
        work()
        delegate?.customerWorkDidFinish(self, customer: customer)
    }

    private func work() {
        DispatchQueue.global().sync {
            Thread.sleep(forTimeInterval: workType.processTime)
        }
    }
}

class BankDepositWindow: BankWindow {
    weak var delegate: BankWindowDelegate?
    let workType: Banking = .deposit

    func receive(_ customer: Customer) {
        delegate?.customerWorkDidStart(self, customer: customer)
        work()
        delegate?.customerWorkDidFinish(self, customer: customer)
    }

    private func work() {
        DispatchQueue.global().sync {
            Thread.sleep(forTimeInterval: workType.processTime)
        }
    }
}
```


#### DispatchQueue, Group, Semaphore

- DispatchGroup ì‚¬ìš©ë²•
    - ì—¬ëŸ¬ ì‘ì—…ì„ë“¤ í•˜ë‚˜ì˜ groupìœ¼ë¡œ ë¬¶ì„ ìˆ˜ ìˆë‹¤
    - group.wait()ìœ¼ë¡œ ê·¸ë£¹ì˜ ì‘ì—…ë“¤ì´ ëª¨ë‘ ëë‚ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦´ ìˆ˜ ìˆë‹¤
    - group.notify()ë¡œ ê·¸ë£¹ì˜ ì‘ì—…ì´ ëë‚ ë•Œ ì•Œë¦¼ì„ ì¤„ ìˆ˜ ìˆë‹¤

```swift
let group = DispatchGroup()

DispatchQueue.global().async(group: group) {
    print("task1")
}

DispatchQueue.global().async(group: group) {
    print("task2")
}

DispatchQueue.global().async(group: group) {
    print("task3")
}

group.notify(queue: .main) {
    print("ëª¨ë“  ì‘ì—…ì´ ëë‚¬ë‹¤!")   
}

/*
task1
task2
task3
ëª¨ë“  ì‘ì—…ì´ ëë‚¬ë‹¤!
*/

```

#### OperationQueue

- BlockOperation ì‚¬ìš©ë²•
- OperationQueueì— Operation ì¶”ê°€í•˜ëŠ” ë²•
- waitUntilAllOperationsAreFinished() ì‚¬ìš©ë²•

ì‹¤í–‰ì¤‘ì¸ ì—°ì‚°ì´ë‚˜ íë“¤ì´ ëë‚  ë•Œê¹Œì§€ í˜„ì¬ ì“°ë ˆë“œê°€ ë¸”ë¡ì´ ë˜ê¸´ í•˜ì§€ë§Œ í”„ë¡œì íŠ¸ì—ì„œëŠ” ë©”ì¸ ì“°ë ˆë“œë¥¼ ë§‰ê¸°ì— ì‚¬ìš©í• ìˆ˜ëŠ” ì—†ì—ˆë‹¤!
```swift 
DispatchQueue.global().sync {
    loanQueue.waitUntilAllOperationsAreFinished()
    depositQueue.waitUntilAllOperationsAreFinished()
}
```

- addOperationì€ êµ³ì´ weak self ì•ˆí•´ë„ ë¨
addOperationê°€ ì‹¤í–‰ë˜ê³  íì—ì„œ ì œê±°ë˜ê²Œ ë˜ìë§ˆì ì°¸ì¡° ì‚¬ì´í´ì´ ì—†ì–´ì§€ê¸° ë•Œë¬¸ì— wek selfë¥¼ ì‚¬ìš©í•  í•„ìš”ê°€ ì—†ë‹¤.

ex)
```swift
let myQueue = OperationQueue()
myQueue.addOperation {
    print("ì‘ì—… ì¶”ê°€1")
}
myQueue.addOperation {
    print("ì‘ì—… ì¶”ê°€2")
}

myQueue.waitUntilAllOperationAreFinished()
```

#### Timer ì‚¬ìš©ë²•

íƒ€ì´ë¨¸ë¥¼ ì‚¬ìš©í•´ì„œ, ì¼ì •ì£¼ê¸°ë¡œ ê°™ì€ ì½”ë“œë¥¼ ë°˜ë³µì‹¤í–‰í•˜ëŠ” ë²•ì„ ë°°ì› ë‹¤

```swift
// íƒ€ì´ë¨¸ ìƒì„±í•˜ëŠ”ë²•
if timer == nil {
    timer = Timer.scheduledTimer(timeInterval: Const.timeInterval, target: self, selector: #selector(startTimer), userInfo: nil, repeats: true)
}

// íƒ€ì´ë¨¸ê°€ ë°˜ë³µë ë•Œë§ˆë‹¤ ì‹¤í–‰ë  í•¨ìˆ˜
@objc private func startTimer() {
    seconds += Const.timeInterval
}

// íƒ€ì´ë¨¸ ì¢…ë£Œí•˜ëŠ”ë²•
timer?.invalidate()
timer = nil


```

#### closureë¥¼ í™œìš©í•œ ë°ì´í„° ì „ë‹¬

closureë¥¼ ì‚¬ìš©í•´ì„œ, ì›í•˜ëŠ” ì‹œì ì— íŠ¹ì • ì½”ë“œê°€ ì‹¤í–‰ë˜ê²Œ í•˜ëŠ” ë²•ì„ ë°°ì› ë‹¤

ex)

```swift
// ë§¤ì„œë“œ ì •ì˜
func work(start: () -> (), end: () -> ()) {
    start()
    //ì‘ì—…..
    end()
}

// ë§¤ì„œë“œ í˜¸ì¶œí•˜ëŠ” ë¶€ë¶„
work {
    print("ì‘ì—…ì„ ì‹œì‘í–ˆìŠµë‹ˆë‹¤")
} end: {
    print("ì‘ì—…ì´ ëë‚¬ìŠµë‹ˆë‹¤")
}
```

#### UUID í™œìš©í•œ ì‹ë³„

```swift
UUID().uuidString
```
ì„ ì‚¬ìš©í•´ì„œ ê°ì²´ì˜ ê³ ìœ í•œ identityë¥¼ êµ¬ë¶„í•  ìˆ˜ ìˆëŠ”ë²•ì„ ë°°ì› ë‹¤

ì˜ˆë¥¼ ë“¤ì–´ ì´ë¥¼ ì•„ë˜ì˜ ë©”ì„œë“œì—ì„œ í™œìš©í•  ìˆ˜ ìˆì—ˆë‹¤.
ëŒ€ê¸°ìŠ¤íƒë·°ì— ê³ ê°ë“¤ì´ ë“¤ì–´ê°€ê²Œ ë˜ë©° ê°ê°ì˜ ê³ ê°ì— ëŒ€í•œ customerViewsì—ì„œ í•˜ë‚˜ì”©ì„ êµ¬ë¶„í•˜ì—¬ ì´ë¥¼ filterë¥¼ í†µí•´ ëº´ë‚¸ ë‹¤ìŒ ëŒ€ê¸°ìŠ¤íƒë·°ì—ì„œ ì œê±°í•˜ëŠ” ë°©ì‹ì— ì‚¬ìš©í–ˆë‹¤.

```swift
func customerWorkDidStart(_ bank: Bank, id: String) {
    DispatchQueue.main.async {
        guard let customerViews = self.bankView.waitStackView.arrangedSubviews as? [CustomerView] else { return }

        guard let targetView = customerViews.filter({ customerView in
            customerView.customer.id == id
        }).first else { return }

        targetView.removeFromSuperview()
        self.bankView.workStackView.addArrangedSubview(targetView)
    }
}
```
