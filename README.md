# iOS ì»¤ë¦¬ì–´ ìŠ¤íƒ€í„° ìº í”„
# ğŸ’° ì€í–‰ì°½êµ¬ ë§¤ë‹ˆì €

> í”„ë¡œì íŠ¸ ê¸°ê°„: 2023.03.06 ~ 2023.03.17
> 
> íŒ€ì›: ğŸ‘¨ğŸ»â€ğŸ’»[kaki](https://github.com/kak1x), ğŸ‘¨ğŸ»â€ğŸ’»[ì†¡ì¤€](https://github.com/kimseongj) | ë¦¬ë·°ì–´: ğŸ‘¨ğŸ»â€ğŸ’»[ë„ë¯¸ë‹‰](https://github.com/AppleCEO)
> 
> ë™ì‹œì„± í”„ë¡œê·¸ë˜ë°ì„ í™œìš©í•˜ì—¬ ì€í–‰ì°½êµ¬ ë§¤ë‹ˆì € ì½˜ì†” ì•± ë° UI ì•± êµ¬í˜„


## ëª©ì°¨
1. [íƒ€ì„ë¼ì¸](#-íƒ€ì„ë¼ì¸)
2. [í”„ë¡œì íŠ¸ êµ¬ì¡°](#-í”„ë¡œì íŠ¸-êµ¬ì¡°)
3. [ì‹¤í–‰ í™”ë©´](#-ì‹¤í–‰-í™”ë©´)
4. [íŠ¸ëŸ¬ë¸” ìŠˆíŒ…](#-íŠ¸ëŸ¬ë¸”-ìŠˆíŒ…)
5. [ì°¸ê³  ë§í¬](#ì°¸ê³ -ë§í¬)

<br/>

# â° íƒ€ì„ë¼ì¸
<details>
    <summary><big>íƒ€ì„ë¼ì¸</big></summary>
- 23.03.06 (ì›”): Linked List Queue êµ¬í˜„, Unit Test êµ¬í˜„ (STEP1 PR)
<br>
- 23.03.07 (í™”): STEP1 ë¦¬ë·° ì‚¬í•­ ìˆ˜ì • (Refactor)
<br>
- 22.03.08 (ìˆ˜): BankManager êµ¬í˜„ ë° ì‹¤í–‰ (STEP2 PR)
<br>
- 22.03.09 (ëª©): STEP2 ë¦¬ë·° ì‚¬í•­ ìˆ˜ì • (ë³€ìˆ˜ëª… ìˆ˜ì •, í•¨ìˆ˜ ë¶„ë¦¬)
<br>
- 22.03.10 (ê¸ˆ) : DispatchQueueë¡œ ì€í–‰ì—…ë¬´ êµ¬í˜„ (STEP3 PR)
<br>
- 22.03.13 (ì›”) : STEP 3 ë¦¬ë·° ì‚¬í•­ ìˆ˜ì • (ë§¤ì§ë„˜ë²„ ì²˜ë¦¬, í•¨ìˆ˜ ë¶„ë¦¬, ì½”ë“œ ì»¨ë²¤ì…˜)
<br>
- 23.03.14 (í™”): STEP4 StackViewë¥¼ í™œìš©í•œ UI êµ¬í˜„, ë¡œì§ì— ëŒ€í•œ ë¹„ë™ê¸° ì²˜ë¦¬
<br>
- 22.03.15 (ìˆ˜): STEP4 Timer êµ¬í˜„, ë²„íŠ¼ êµ¬í˜„ (STEP4 PR)
<br>
- 22.03.16 (ëª©): STEP4 ë¦¬ë·° ì‚¬í•­ ìˆ˜ì •
    
    
</details>
<br/>
<br/>
    
# âœğŸ» í”„ë¡œì íŠ¸ êµ¬ì¡°
<details>
    <summary><big>ConsoleAppí´ë”êµ¬ì¡°</big></summary>
<img src = "https://i.imgur.com/qvSxhAo.png">
    </details>

<br>

<details>
    <summary><big>UIAppí´ë”êµ¬ì¡°</big></summary>
<img src = "https://i.imgur.com/uNTmjiy.png">
    </details>
    
<br/>
<br/>

# âœ¨ ì‹¤í–‰ í™”ë©´

### ì€í–‰ì°½êµ¬ ConsoleApp ì‹¤í–‰í™”ë©´
![ì½˜ì†”ì•±ì‹¤í–‰](https://user-images.githubusercontent.com/51234397/225524048-c3d06915-21e7-4cb8-a79c-61cbc1b9940f.gif)

### ì€í–‰ì°½êµ¬ ConsoleApp ì¢…ë£Œí™”ë©´
![ì½˜ì†”ì•±ì¢…ë£Œ](https://user-images.githubusercontent.com/51234397/225524059-b7b22114-ba3c-4d03-9a90-d1ceb15a348c.gif)


### ì€í–‰ì°½êµ¬ UIApp ì‹¤í–‰í™”ë©´
|<center>ê³ ê°ì¶”ê°€ ë²„íŠ¼ ì‹¤í–‰</center>|<center>ì‹¤í–‰ ì¤‘ ì´ˆê¸°í™”</center>|<center>ì‹¤í–‰ ì¢…ë£Œ í›„ ì´ˆê¸°í™”</center>|
|---|---|---|
| <img src = "https://user-images.githubusercontent.com/88870642/225524404-afb6cce9-9fa5-452b-83f9-ca12bb533eea.gif" width = 200> | <img src = "https://user-images.githubusercontent.com/88870642/225523034-4117d522-f8f3-41ed-a8a9-1b174d1dea5c.gif" width = 200> | <img src = "https://user-images.githubusercontent.com/88870642/225522780-29fa384b-1802-4ed0-ab49-87c6c680d8dd.gif" width = 200>


# ğŸ”¥ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…
## ConsoleApp
### 1. í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„± ì‹œ givenê³¼ when êµ¬ë¶„
>ì•„ë˜ì™€ ê°™ì´ í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„± ì‹œ `given`ê³¼ `when`ì— ë¬´ì—‡ì„ ì ì–´ì•¼í• ì§€ ê³ ë¯¼í–ˆìŠµë‹ˆë‹¤. `given`ì€ ì–´ë–¤ ìƒí™©ì´ ì£¼ì–´ì§€ê³ , `when`ì€ ì–´ë–¤ ì½”ë“œë¥¼ ì‹¤í–‰í•œë‹¤ê³  ë°°ì› ìŠµë‹ˆë‹¤. ì´ ë¶€ë¶„ì— ìˆì–´`enqueue`ë©”ì„œë“œëŠ” `given`ì¸ì§€, `when`ì¸ì§€ í—·ê°ˆë ¸ìŠµë‹ˆë‹¤.

```swift
// 1ë²ˆ
func test_dequeueëì„ê²½ìš°_ì²˜ìŒ_enqueueëœ_ë°ì´í„°ê°€_ë°˜í™˜ëœë‹¤() {
        // given
        let expectation = "hello"
        // when
        sut.enqueue("hello")
        sut.enqueue("kaki")
        sut.enqueue("songjun")
        let result = sut.dequeue()!
        // then
        XCTAssertEqual(result, expectation)
    }

// 2ë²ˆ
func test_dequeueëì„ê²½ìš°_ì²˜ìŒ_enqueueëœ_ë°ì´í„°ê°€_ë°˜í™˜ëœë‹¤() {
        // given
        let expectation = "hello"
        sut.enqueue("hello")
        sut.enqueue("kaki")
        sut.enqueue("songjun")
        // when
        let result = sut.dequeue()!
        // then
        XCTAssertEqual(result, expectation)
    }

```

### âš’ï¸ í•´ê²°ë°©ë²•
> given ì€ í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ ë§Œë“œëŠ” ê²ƒì´ê³  when ì€ í…ŒìŠ¤íŠ¸í•˜ê³  ì‹¶ì€ ì¤‘ìš” ê¸°ëŠ¥ì„ ì‹¤í–‰í•œë‹¤ë¼ê³  ë‚˜ë‰˜ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœ„ í…ŒìŠ¤íŠ¸ì—ì„œ ì¤‘ìš” ê¸°ëŠ¥ì€ dequeueì´ê³  enqueueì‘ì—…ì€ í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ ë§Œë“¤ì–´ì£¼ëŠ” ê²ƒì´ë¼ ìƒê°ë˜ì–´ 2ë²ˆ ë°©ë²•ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.

</br>

### 2. í”„ë¡œê·¸ë¨ ì‹¤í–‰ ì‹œê°„ í™•ì¸
> ê¸°ì¡´ì—” ê³ ê° í•œ ëª…ë‹¹ 0.7ì´ˆì”© ê³ ì •ì ìœ¼ë¡œ ì‹œê°„ì„ ì†Œìš”í•˜ê¸° ë•Œë¬¸ì— í”„ë¡œê·¸ë¨ ì‹¤í–‰ ì‹œê°„ì„ ê³ ê°ìˆ˜ * 0.7 ì´ˆë¡œ ê³„ì‚°í•´ì£¼ì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ Step3ë¡œ ë„˜ì–´ì˜¤ë©° ëŒ€ì¶œ ì—…ë¬´ ê³ ê°ì€ 1.1ì´ˆ, ì˜ˆê¸ˆ ì—…ë¬´ ê³ ê°ì€ 0.7ì´ˆë¡œ ê°ê¸° ë‹¤ë¥¸ ì‹œê°„ì´ ì†Œìš”ë˜ì–´ ê¸°ì¡´ì˜ ë°©ì‹ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.

### âš’ï¸ í•´ê²°ë°©ë²•
```swift
mutating func processBusiness() {
    let startTime = CFAbsoluteTimeGetCurrent()
    
    while !waitingQueue.isEmpty {
        guard let client = waitingQueue.dequeue() else { return }
        processBankTask(client)
    }
    group.wait()
    
    let wasteTime = CFAbsoluteTimeGetCurrent() - startTime
    presentBusinessResult(time: wasteTime)
}
```

> CFAbsoluteTimeGetCurrent()ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹œì‘ë˜ëŠ” ì‹œì ì˜ ì‹œê°„ì„ í”„ë¡œê·¸ë¨ ì‹¤í–‰ì´ ëë‚¬ì„ë•Œì˜ ì‹œê°„ì—ì„œ ë¹¼ì£¼ëŠ” ê²ƒìœ¼ë¡œ ì´ ì†Œìš”ì‹œê°„ì„ ê³„ì‚°í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

### 3. ë¹„ë™ê¸° ì½”ë“œë¥¼ ë„˜ê¸°ê³  ë°”ë¡œ ë’¤ì˜ ì½”ë“œë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” í˜„ìƒ
> ì—…ë¬´ì— ê´€í•œ ì½”ë“œë¥¼ ì „ë¶€ ë¹„ë™ê¸°ë¡œ ì„¤ì •í•´ì£¼ì—ˆë”ë‹ˆ ë¹„ë™ê¸° ì½”ë“œë¥¼ ë°”ë¡œ ëë‚´ê³  ì•„ì˜ˆ ê¸°ë‹¤ë¦¬ì§€ ì•Šì€ ì±„ ë’¤ì˜ ì½”ë“œë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.

![](https://i.imgur.com/seTy6Jj.png)

### âš’ï¸ í•´ê²°ë°©ë²•
```swift
mutating func processBusiness() {
    while !waitingQueue.isEmpty {
        guard let client = waitingQueue.dequeue() else { return }
        processBankTask(client)
    }
    group.wait()
    
    presentBusinessResult(time: wasteTime)
}

private func processBankTask(_ client: Client) {
    if client.requstedTask == .loan {
        DispatchQueue.global().async(group: group) {
            loanSemaphore.wait()
            loanSemaphore.signal()
        }
    } else {
        DispatchQueue.global().async(group: group) {
            depositSemaphore.wait()
            depositSemaphore.signal()
        }
    }
}
```

> DispatchGroupì„ ì´ìš©í•˜ì—¬ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬ë˜ëŠ” ì‘ì—…ë“¤ì„ ê·¸ë£¹ìœ¼ë¡œ ë¬¶ì–´ì£¼ê³ , group.wait()ì„ ì‚¬ìš©í•˜ì—¬ DispatchGroupì˜ ìˆ˜í–‰ì´ ëë‚˜ëŠ”ê²ƒì„ ê¸°ë‹¤ë¦¬ê²Œ í•´ì£¼ì–´ ë¬¸ì œë¥¼ í•´ê²°í•˜ì˜€ìŠµë‹ˆë‹¤.

## UIApp

### 1. DispatchQueue -> OperationQueue
> ì´ˆê¸°í™” ë²„íŠ¼ ê¸°ëŠ¥ êµ¬í˜„ ì‹œ, ì´ˆê¸°í™”ë¥¼ ëˆ„ë¥´ë©´ ìŠ¤ë ˆë“œê°€ í•˜ë˜ ì¼ë„ cancelì´ ë˜ì–´ì•¼ í•˜ëŠ”ë° DispatchQueueì—ì„œ ì§„í–‰ì¤‘ì¸ ìŠ¤ë ˆë“œë¥¼ ë©ˆì¶œ ë°©ë²•ì„ ì°¾ì„ ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.
![](https://camo.githubusercontent.com/5e32a8b9e1f7c27db52a803a1463d447f82f9078eb7a1c0792cd478d3b9ac2ce/68747470733a2f2f692e696d6775722e636f6d2f54686c757770452e706e67)
ë˜í•œ main ìŠ¤ë ˆë“œì—ì„œ ì‘ì—… ì²˜ë¦¬ ì‹œ, qosë¥¼ ë³€ê²½í•´ì£¼ì§€ ì•Šê³  dispatch_semaphore_wait ë° dispatch_group_waitì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ì—ëŸ¬ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.

### âš’ï¸ í•´ê²°ë°©ë²•
```swift
private let loanQueue = OperationQueue()
private let depositQueue = OperationQueue()

private func processBankTask(_ client: Client) {
    if client.requstedTask == .loan {
        loanQueue.maxConcurrentOperationCount = 1
        loanQueue.addOperation {
            processPersonalBankTask(client)
        }
    } else if client.requstedTask == .deposit {
        depositQueue.maxConcurrentOperationCount = 2
        depositQueue.addOperation {
            processPersonalBankTask(client)
        }
    }
}
```
> DispatchQueue ëŒ€ì‹  OperationQueueë¥¼ ì‚¬ìš©í•˜ì—¬ ë¬¸ì œë¥¼ í•´ê²°í•˜ì˜€ìŠµë‹ˆë‹¤.
> ë˜í•œ DispatchQueueì—ì„œ ë¶ˆê°€ëŠ¥í–ˆë˜ ìŠ¤ë ˆë“œë¥¼ ë©ˆì¶”ëŠ” ê²ƒ ë˜í•œ cancelAllOperations() ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ í•´ê²°í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

### 2. StackView Alignment ë¬¸ì œ
> ìŠ¤íƒë·°ì— autoLayoutê°’ì´ ì •í™•í•˜ê²Œ ë“¤ì–´ê°€ì§€ ì•Šì•„ ìƒê¸°ëŠ” ë¬¸ì œì ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤. 
> alignmentë¥¼ defaultê°’(fill)ìœ¼ë¡œ ë„£ìœ¼ë©´ ì•„ë˜ ì˜¤ë¥˜ ì‚¬í•­ì²˜ëŸ¼ UIê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

### âš’ï¸ í•´ê²°ë°©ë²•
> alignmentê°’ì„ topìœ¼ë¡œ ì£¼ì–´ ë¬¸ì œë¥¼ í•´ê²°í–ˆìŠµë‹ˆë‹¤.

|<center>ì˜¤ë¥˜ ì‚¬í•­</center>| <center>ì˜¤ë¥˜ ì‚¬í•­ í•´ê²°</center>|
|---|---|
|<img src = "https://user-images.githubusercontent.com/88870642/225525993-de7495fc-5afc-430b-820c-d8367255670f.gif" width = 200>|<img src = "https://user-images.githubusercontent.com/88870642/225524404-afb6cce9-9fa5-452b-83f9-ca12bb533eea.gif" width = 200>|


<br/>
<br/>

# ì°¸ê³  ë§í¬
* [Apple Developer Documentation - CFAbsoluteTimeGetCurrent()](https://developer.apple.com/documentation/corefoundation/1543542-cfabsolutetimegetcurrent)
* [ì•¼ê³° ë‹·ë„· - ë™ì‹œì„± í”„ë¡œê·¸ë˜ë°](https://yagom.net/courses/ë™ì‹œì„±-í”„ë¡œê·¸ë˜ë°-concurrency-programming/)
* [Apple Developer Documentation - DispatchGroup](https://developer.apple.com/documentation/dispatch/dispatchgroup)
* [Apple Developer Documentation - OperationQueue](https://developer.apple.com/documentation/foundation/operationqueue)
* [Apple Developer Documentation - Diagnosing performance issues early](https://developer.apple.com/documentation/xcode/diagnosing-performance-issues-early)
